<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>{{title}}</title>
</head>

<body>
  <div>hello world</div>
  <div>{{name}}</div>
  <div class="register">
    <input placeholder="用户名" id='uname' />
    <input placeholder="电话" id='rphone' />
    <input placeholder="密码" id='rpassword' />
    <button id='registerBtn'>注册</button>
  </div>
  <div class="login">
    <input placeholder="电话" id='phone' />
    <input placeholder="密码" id='password' />
    <button id='button'>登录</button>
  </div>
</body>
<script type="application/javascript">
  var b = `{{ name }}`
  console.log(b)
  var btnEl = document.getElementById('button')
  var registerEl = document.getElementById('registerBtn')

  var phoneEl = document.getElementById('phone')
  var passwordEl = document.getElementById('password')

  var rnameEl = document.getElementById('uname')
  var rphoneEl = document.getElementById('rphone')
  var rpasswordEl = document.getElementById('rpassword')
  btnEl.onclick = function () {
    var data = {
      userName: phoneEl.value,
      password: passwordEl.value
    };
    Login(data)
  }

  registerEl.onclick = function (params) {
    var data = {
      userMobile: rphoneEl.value,
      userName: rnameEl.value,
      password: rpasswordEl.value
    };
    register(data)
  }

  function Login(params) {
    http({
      type: "post",
      url: "/login",
      dataType: "json",
      data: params,
      success: function (data) {
        alert(data.msg)
      },
      error: function () {
        console.log("error")
      }
    })
  }

  function register(params) {
    http({
      type: "post",
      url: "/register",
      dataType: "json",
      data: params,
      success: function (msg) {
        console.log(msg)
      },
      error: function () {
        console.log("error")
      }
    })
  }

  function http() {
    var ajaxData = {
      type: arguments[0].type || "GET",
      url: arguments[0].url || "",
      async: arguments[0].async || "true",
      data: arguments[0].data || null,
      dataType: arguments[0].dataType || "text",
      contentType: arguments[0].contentType || "application/x-www-form-urlencoded",
      beforeSend: arguments[0].beforeSend || function () {},
      success: arguments[0].success || function () {},
      error: arguments[0].error || function () {}
    }
    ajaxData.beforeSend()
    var xhr = createxmlHttpRequest();
    xhr.responseType = ajaxData.dataType;
    xhr.open(ajaxData.type, ajaxData.url, ajaxData.async);
    xhr.setRequestHeader("Content-Type", ajaxData.contentType);
    xhr.send(convertData(ajaxData.data));
    xhr.onreadystatechange = function () {
      if (xhr.readyState == 4) {
        if (xhr.status == 200) {
          ajaxData.success(xhr.response)
        } else {
          ajaxData.error()
        }
      }
    }
  }

  function createxmlHttpRequest() {
    if (window.ActiveXObject) {
      return new ActiveXObject("Microsoft.XMLHTTP");
    } else if (window.XMLHttpRequest) {
      return new XMLHttpRequest();
    }
  }

  function convertData(data) {
    if (typeof data === 'object') {
      var convertResult = "";
      for (var c in data) {
        convertResult += c + "=" + data[c] + "&";
      }
      convertResult = convertResult.substring(0, convertResult.length - 1)
      return convertResult;
    } else {
      return data;
    }
  }
</script>

</html>